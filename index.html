<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Money - Pro</title>
    
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/10972/10972494.png?v=1">
    <link rel="manifest" href="manifest.json?v=1">
    <link rel="stylesheet" href="style.css">

    <style>
        /* Стили для кнопок выбора типа транзакции */
        .type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .type-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            background: #f9f9f9;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: 0.3s;
        }
        .type-btn.active-income {
            background-color: #2ecc71;
            color: white;
            border-color: #27ae60;
        }
        .type-btn.active-expense {
            background-color: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Smart Money</h1>
        
        <div class="balance-card">
            <p>Twój Balans:</p>
            <h2 id="balance">0.00 PLN</h2>
        </div>

        <div class="form">
            <label>Rodzaj transakcji:</label>
            <div class="type-selector">
                <button type="button" id="btnIncome" class="type-btn active-income" onclick="setType('income')">Przychód (+)</button>
                <button type="button" id="btnExpense" class="type-btn" onclick="setType('expense')">Wydatek (-)</button>
            </div>

            <input type="text" id="title" placeholder="Nazwa (np. Zakupy)">
            <input type="number" id="amount" placeholder="Kwota" inputmode="decimal">
            <input type="date" id="date">
            <button onclick="addTransaction()" class="main-btn">Dodaj Transakcję</button>
        </div>

        <div class="filters">
            <input type="date" id="filterFrom">
            <input type="date" id="filterTo">
            <button onclick="exportData()" class="export-btn">Pobierz Raport (.txt)</button>
        </div>

        <ul id="history"></ul>
    </div>

    <script>
        let currentType = 'income';

        // Функция переключения типа (Доход/Расход)
        function setType(type) {
            currentType = type;
            const btnInc = document.getElementById('btnIncome');
            const btnExp = document.getElementById('btnExpense');

            if (type === 'income') {
                btnInc.classList.add('active-income');
                btnExp.classList.remove('active-expense');
            } else {
                btnExp.classList.add('active-expense');
                btnInc.classList.remove('active-income');
            }
        }

        // Загрузка данных
        let transactions = JSON.parse(localStorage.getItem('moneyData')) || [];

        function updateUI() {
            const history = document.getElementById('history');
            const balance = document.getElementById('balance');
            history.innerHTML = '';
            
            let total = 0;
            transactions.forEach((t, index) => {
                total += t.amount;
                const li = document.createElement('li');
                li.className = t.amount > 0 ? 'income-item' : 'expense-item';
                li.innerHTML = `
                    <span>${t.title} (${t.date})</span>
                    <b>${t.amount.toFixed(2)} PLN</b>
                    <button onclick="deleteItem(${index})">x</button>
                `;
                history.appendChild(li);
            });
            balance.innerText = `${total.toFixed(2)} PLN`;
            localStorage.setItem('moneyData', JSON.stringify(transactions));
        }

        function addTransaction() {
            const title = document.getElementById('title').value;
            let amount = parseFloat(document.getElementById('amount').value);
            const date = document.getElementById('date').value;

            if (!title || isNaN(amount) || !date) {
                alert('Wypełnij wszystkie pola!');
                return;
            }

            // Если выбран "Расход", делаем число отрицательным автоматически
            if (currentType === 'expense') {
                amount = -Math.abs(amount);
            } else {
                amount = Math.abs(amount);
            }

            transactions.push({ title, amount, date });
            updateUI();
            
            // Сброс формы
            document.getElementById('title').value = '';
            document.getElementById('amount').value = '';
        }

        function deleteItem(index) {
            transactions.splice(index, 1);
            updateUI();
        }

        function exportData() {
            const from = document.getElementById('filterFrom').value;
            const to = document.getElementById('filterTo').value;
            
            let filtered = transactions;
            if (from && to) {
                filtered = transactions.filter(t => t.date >= from && t.date <= to);
            }

            let text = "RAPORT FINANSOWY\n\n";
            filtered.forEach(t => {
                text += `${t.date} | ${t.title}: ${t.amount.toFixed(2)} PLN\n`;
            });

            const blob = new Blob([text], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = 'raport_finansowy.txt';
            anchor.href = window.URL.createObjectURL(blob);
            anchor.click();
        }

        // Установка сегодняшней даты по умолчанию
        document.getElementById('date').valueAsDate = new Date();
        updateUI();
    </script>
</body>
</html>
